<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:p="http://primefaces.org/ui" 
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition>

	<c:if test="${empty childField}">
		<c:set var="fieldName" value="#{field}" />
	</c:if>
	
	<c:if test="${not empty childField}">
		<c:set var="fieldName" value="#{childField}" />
	</c:if>

	<c:if test="${empty isMessage}">
		<c:set var="isMessage" value="false" />
	</c:if>

	<c:if test="${empty show}">
		<c:set var="show" value="true" />
	</c:if>

	<c:if test="${empty isDate}">
		<c:set var="isDate" value="false" />
	</c:if>

	<c:if test="${empty time}">
		<c:set var="time" value="false" />
	</c:if>
	
	<c:if test="${time}">
		<c:set var="datePattern" value="#{messages['happyfaces.dateTimeFormat']}" />
	</c:if>
	
	<c:if test="${!time}">
		<c:set var="datePattern" value="#{messages['happyfaces.dateFormat']}" />
	</c:if>

	<c:if test="${empty isList}">
		<c:set var="isList" value="false" />
	</c:if>
	
	<c:if test="${empty sort}">
		<c:set var="sort" value="true" />
	</c:if>

	<c:if test="${empty childFieldId}">
		<c:set var="childFieldId" value="id" />
	</c:if>

	<p:column>
        <f:attribute rendered="#{sort}" name="sortBy" value="#{field}"/>
		<f:facet name="header">
       		<h:outputText value="#{label}" />
        </f:facet>

		<ui:fragment rendered="#{not empty field}">
				<!-- If there is no child field, just show fieldValue. However if fieldValue can be message check if it is not boolean first
		        	if so use standard yes and no messages. If its not boolean just translate fieldValue message. 
		        	Also if childField is not set then it basically means it can't be isList=true even if it is set, so we don't check isList here.-->
				<ui:fragment rendered="#{empty childField}">
					<ui:fragment rendered="#{isMessage}">
						<h:outputText rendered="#{entity[field] != null and entity[field].toString() == 'true'}" value="#{messages['commons.yes']}" />
						<h:outputText rendered="#{entity[field] != null and entity[field].toString() == 'false'}" value="#{messages['commons.no']}" />
						<h:outputText rendered="#{entity[field] != null and entity[field].toString() != 'true' and entity[field].toString() != 'false'}" value="#{messages[entity[field]]}" />
					</ui:fragment>
					<ui:fragment rendered="#{!isMessage}">
						<!-- If there is date field, show date in specified pattern 
				    	 If isDate is not set then it basically means it is not a date. Also if time is not set it basically means that time=true
				    	 -->
						<h:outputText value="#{entity[field]}" rendered="#{!isDate and show}" converter="#{getConverter.forType(entity[field], converterParam)}" />

						<h:outputText value="#{entity[field]}" rendered="#{isDate}">
							<f:convertDateTime pattern="#{datePattern}" />
						</h:outputText>

					</ui:fragment>
				</ui:fragment>

				<!-- If childField parameter is provided that means fieldValue is entity, enum or list. -->
				<ui:fragment rendered="#{not empty childField}">
					<!-- If field is not list, then it means it is either another entity or enum. -->
					<ui:fragment rendered="#{not isList}">
						<!-- If childField ID is not provided then we dont need link to entity page. -->
						<ui:fragment rendered="#{empty entityView}">
							<ui:fragment rendered="#{isMessage}">
								<h:outputText rendered="#{entity[field][childField] != null and entity[field][childField].toString() == 'true'}" value="#{messages['commons.yes']}" />
								<h:outputText rendered="#{entity[field][childField] != null and entity[field][childField].toString() == 'false'}" value="#{messages['commons.no']}" />
								<h:outputText rendered="#{entity[field][childField] != null and entity[field][childField].toString() != 'true' and entity[field][childField].toString() != 'false'}" value="#{messages[entity[field][childField]]}" />
							</ui:fragment>
							<h:outputText rendered="#{!isMessage}" value="#{entity[field][childField]}" />
						</ui:fragment>
						<!-- If entityView provided then show link to childField entity page. -->
						<ui:fragment rendered="#{not empty entityView}">
							<hf:linkToEntity linkId="#{field}_#{childField}_message_link" rendered="#{isMessage}" entity="#{entity[field]}" popupFields="#{popupFields}" entityId="#{entity[field][childFieldId]}" value="#{messages[entity[field][childField]]}" view="#{entityView}"/>
							<hf:linkToEntity linkId="#{field}_#{childField}_link" rendered="#{!isMessage}" entity="#{entity[field]}" popupFields="#{popupFields}" entityId="#{entity[field][childFieldId]}" value="#{entity[field][childField]}" view="#{entityView}"/>
						</ui:fragment>
					</ui:fragment>

					<!-- If its list then run through it and show results. -->
					<ui:fragment rendered="#{isList}">
						<c:set var="list" value="#{entity[field]}" />
						<ui:repeat value="#{entity[field]}" var="c">
							<!-- If childField ID is not provided then we dont need link to entity page. -->
							<ui:fragment rendered="#{empty entityView}">
								<ui:fragment rendered="#{isMessage}">
									<h:outputText rendered="#{c[childField] != null and c[childField].toString() == 'true'}" value="#{messages['commons.yes']}" />
									<h:outputText rendered="#{c[childField] != null and c[childField].toString() == 'false'}" value="#{messages['commons.no']}" />
									<h:outputText rendered="#{c[childField] != null and c[childField].toString() != 'true' and c[childField].toString() != 'false'}" value="#{messages[c[childField]]}" />
								</ui:fragment>
								<h:outputText rendered="#{not isMessage}" value="#{c[childField]}" />
							</ui:fragment>
							<!-- If entityView provided then show link to childField entity page. -->
							<ui:fragment rendered="#{not empty entityView}">
								<hf:linkToEntity linkId="#{field}_#{childField}_message_link" rendered="#{isMessage}" entityId="#{c[childFieldId]}" entity="#{c}" popupFields="#{popupFields}" value="#{c[childField]}" view="#{entityView}"/>
								<hf:linkToEntity linkId="#{field}_#{childField}_link" rendered="#{not isMessage}" entity="#{c}" popupFields="#{popupFields}" entityId="#{c[childFieldId]}" value="#{c[childField]}" view="#{entityView}"/>
							</ui:fragment>
							<br />
						</ui:repeat>
					</ui:fragment>
				</ui:fragment>
		</ui:fragment>
		<ui:insert />
	</p:column>

</ui:composition>

</html>
